/*! or-cachejs - v0.1.0 - 2012-10-11 */
(function(e,t){"use strict";typeof define=="function"&&define.amd?define(["backbone","jquery","underscore","jquery.store"],t):e.Backbone.Cache=t(e.Backbone,e.jQuery,e._)})(this,function(e,t,n){"use strict";var r={base64:{encode:function(e){e=e||"";var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789._-",n="",r=0,i,s,o,u,a,f,l;while(r<e.length)i=e.charCodeAt(r++),s=e.charCodeAt(r++),o=e.charCodeAt(r++),u=i>>2,a=(i&3)<<4|s>>4,f=(s&15)<<2|o>>6,l=o&63,isNaN(s)?f=l=64:isNaN(o)&&(l=64),n=n+t.charAt(u)+t.charAt(a)+t.charAt(f)+t.charAt(l);return n},decode:function(e){e=e||"";var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789._-",n="",r=0,i,s,o,u,a,f,l;while(r<e.length)u=t.indexOf(e.charAt(r++)),a=t.indexOf(e.charAt(r++)),f=t.indexOf(e.charAt(r++)),l=t.indexOf(e.charAt(r++)),i=u<<2|a>>4,s=(a&15)<<4|f>>2,o=(f&3)<<6|l,n+=String.fromCharCode(i),f!==64&&(n+=String.fromCharCode(s)),l!==64&&(n+=String.fromCharCode(o));return n}}},i={cache:new e.Model,store:new t.store,encoders:{base64:r.base64},encoder:"base64",scrambled:!1,setEncoder:function(e){this.encoders[e]&&(this.encoder=e)},setScramble:function(e){n.isBoolean(e)&&(this.isScrambled=e)},scramble:function(e){return this.encoders[this.encoder].encode(e)},unscramble:function(e){return this.encoders[this.encoder].decode(e)},get:function(e,t){var n=this.cache.get(e);if(!n||t){if(this.scrambled){var r=this.scramble(e);n=this.unscramble(this.store.get(r));try{n=JSON.parse(n)}catch(i){n=null,this.store.del(r),this.cache.unset(e,{silent:!0})}}else n=this.store.get(e);this.cache.set(e,n,{silent:!0})}return n},set:function(e,t){return this.isScrambled?this.store.set(this.scramble(e),this.scramble(JSON.stringify(t))):this.store.set(e,t),this.cache.set(e,t),t},unset:function(e){this.cache.unset(e),this.store.del(this.isScrambled?this.scramble(e):e)},del:function(e){this.unset(e)},flush:function(){this.cache.clear(),this.store.flush()}};return function(){i.store.driver.scope="browser",i.store.encoders=["xml","json"],i.store.decoders=["json","xml"]}(),i});